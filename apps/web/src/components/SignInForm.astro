---
import { authClient } from "../lib/auth-client";
---

<div class="mx-auto mt-10 w-full max-w-md p-6">
  <h1 class="mb-6 text-center font-bold text-3xl text-white">Welcome Back</h1>

  <form id="signin-form" class="space-y-4">
    <div class="space-y-1">
      <label for="email" class="block text-sm font-medium text-neutral-300">Email</label>
      <input
        id="email"
        name="email"
        type="email"
        required
        class="w-full rounded-lg border border-neutral-700 bg-neutral-800 px-4 py-2.5 text-white placeholder-neutral-500 focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500"
        placeholder="you@example.com"
      />
      <p id="email-error" class="text-sm text-red-500 hidden"></p>
    </div>

    <div class="space-y-1">
      <label for="password" class="block text-sm font-medium text-neutral-300">Password</label>
      <input
        id="password"
        name="password"
        type="password"
        required
        class="w-full rounded-lg border border-neutral-700 bg-neutral-800 px-4 py-2.5 text-white placeholder-neutral-500 focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500"
        placeholder="••••••••"
      />
      <p id="password-error" class="text-sm text-red-500 hidden"></p>
    </div>

    <p id="form-error" class="text-sm text-red-500 hidden"></p>

    <button
      type="submit"
      class="w-full rounded-lg bg-indigo-600 px-4 py-2.5 text-sm font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 focus:ring-offset-neutral-900 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
    >
      Sign In
    </button>
  </form>

  <div class="mt-4 text-center">
    <a href="/signup" class="text-indigo-400 hover:text-indigo-300 text-sm">
      Need an account? Sign Up
    </a>
  </div>
</div>

<script>
  import { authClient } from "../lib/auth-client";

  const form = document.getElementById("signin-form") as HTMLFormElement;
  const emailInput = document.getElementById("email") as HTMLInputElement;
  const passwordInput = document.getElementById("password") as HTMLInputElement;
  const formError = document.getElementById("form-error") as HTMLParagraphElement;
  const submitButton = form.querySelector('button[type="submit"]') as HTMLButtonElement;

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    
    formError.classList.add("hidden");
    submitButton.disabled = true;
    submitButton.textContent = "Signing in...";

    try {
      await authClient.signIn.email(
        {
          email: emailInput.value,
          password: passwordInput.value,
        },
        {
          onSuccess: () => {
            window.location.href = "/dashboard";
          },
          onError: (ctx) => {
            formError.textContent = ctx.error.message || "Sign in failed. Please try again.";
            formError.classList.remove("hidden");
          },
        }
      );
    } catch (error) {
      formError.textContent = "An unexpected error occurred.";
      formError.classList.remove("hidden");
    } finally {
      submitButton.disabled = false;
      submitButton.textContent = "Sign In";
    }
  });
</script>
